const r = require('./db');

exports.firstChange = res => {
  const change = res.changes[0];

  return {
    result: change.new_val || change,
    old_val: change.old_val
  };
}

exports.addTransformations = (table, params) => {
  return ['orderBy', 'skip', 'limit'].reduce((q, item) => {
    if (params[item]) {
      //TODO - this does not use an index if there is one
      if (item === 'orderBy') {
        const order = params.order || 'asc'
        q = q[item](r[order](params[item]));
      } else {
        q = q[item](params[item]);
      }
    }
    return q;
  }, table);
}
