require('must');
require('dotenv-safe').load({ sample: './example.env' });
require('app-module-path').addPath(require('path').resolve(__dirname, '..'));

const mocha = require('mocha');
const coMocha = require('co-mocha');

coMocha(mocha);

const { thinky } = require('../config');

process.nextTick(() => {
  before(function* () {
    yield thinky.dbReady();
  });
});

const app = require('../src/app');
const doubleagent = require('doubleagent');

exports.app = doubleagent(app);

if (app.io) { app.io.attach(exports.app.server); }
