require('dotenv').config();

const path = require('path');
require('app-module-path').addPath(path.resolve(__dirname, '..'));

const must = require('must');

const setup = require('setup');
const app = require('index');
const r = require('lib/db');

app.listen(process.env.PORT, () => {
  before(function() {
    this.timeout(30000);

    return setup()
      .then(() => {
        after(() => {
          r.dbDrop('{{name}}')
            .then(() => r.getPoolMaster().drain())
            .then(() => Promise.resolve(app.close()));
        });
      });
  });
});
