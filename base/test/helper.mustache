const path = require('path');
const must = require('must');

const setup = require('root/setup');
const app = require('root/index');
const r = require('root/lib/db');

const server = app.listen(process.env.PORT, () => {
  setup().then(() => {
    after(() => Promise.all([
      r.dbDrop('{{name}}'),
      r.getPoolMaster().drain(),
      Promise.resolve(app.close())
    ]));
  });
});
