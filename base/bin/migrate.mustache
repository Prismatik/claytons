const migrate = require('root/lib/migrate');
const r = require('root/lib/db');

const direction = process.argv[2];

const barf = (msg) => {
  console.log(msg);
  process.exit(1);
};

if (!process.argv[2]) {
  barf('usage: npm run migrate [DIRECTION] [BACKSTOP]');
};

if (['up', 'down'].indexOf(direction) < 0) {
  barf('migration direction must be up or down');
};

if (direction === 'up' && process.argv[3]) {
  barf('migrate up does not take an argument');
};

migrate[direction](process.argv[3])
.then(() => {
  r.getPoolMaster().drain()
  .then(() => process.exit());
});
